<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>이메일 인증</title>
</head>
<body>
  <h1>이메일 인증 중...</h1>
  <p id="statusMessage">인증을 진행하고 있습니다. 잠시만 기다려 주세요.</p>

  <script>
    // Supabase 클라이언트 초기화
    const supabase = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);

    // URL에서 access_token 파라미터 가져오기
    const urlParams = new URLSearchParams(window.location.search);
    const accessToken = urlParams.get("access_token");

    if (!accessToken) {
      document.getElementById("statusMessage").textContent = "인증 링크가 잘못되었습니다. 다시 시도해 주세요.";
      return;
    }

    // 이메일 인증 처리 함수
    const verifyEmail = async () => {
      try {
        // accessToken을 사용하여 이메일 인증 진행
        const { error } = await supabase.auth.api.verifyEmail(accessToken);

        if (error) {
          document.getElementById("statusMessage").textContent = `인증 실패: ${error.message}`;
          return;
        }

        // 인증 성공 후 메시지 출력
        document.getElementById("statusMessage").textContent = "이메일 인증이 완료되었습니다! 로그인 페이지로 이동합니다.";

        // 인증 후 2초 후에 로그인 페이지로 리디렉션
        setTimeout(() => {
          window.location.href = "/login"; // 로그인 페이지 URL로 변경
        }, 2000); // 2초 후 리디렉션
      } catch (error) {
        document.getElementById("statusMessage").textContent = `인증 중 오류가 발생했습니다: ${error.message}`;
      }
    };

    // 이메일 인증 함수 호출
    verifyEmail();
  </script>
</body>
</html>
